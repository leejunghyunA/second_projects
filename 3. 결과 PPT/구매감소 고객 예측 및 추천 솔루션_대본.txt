—-------------------------발표 시작 —----------------------------

<주제 소개 및 팀원 소개>
저희 4조 발표 시작하겠니다.
저희는 구매 감소 고객 예측 및 추천 솔루션을 발표할 universe 팀이며 
저는 발표를 맡은 이정현입니다.

목차는 크게 5가지로 개요, 탐색적 분석, 모델링, 군집화, 추천시스템을 통한 마케팅 제언으로 구성되어있습니다. 

—-------------------------1. 개요 —----------------------------
우선 저희가 활용한 개발 도구입니다. 저희는 오라클과 파이썬을 통해 데이터 탐색을 진행하였고, 사이킷런과 파이캐럿을 이용하여 학습모델을 만들어 준 후,  이를 토대로 서프라이즈를 활용하여 추천시스템을 구현하였습니다. 
다음은 팀원 소개 입니다. 팀원은 최애림, 양주희, 진청아, 이정현 A로 구성되어있습니다.

저희는 L.MEMBERS에서 제공하는 2014년 2015년 구매 데이터를 가지고 4개의 계열사에서 구매한 고객을 대상으로 2년간의 구매 패턴을 파악 후 구매 감소 고객 예측 모델을 생성하여 해당 감소 고객에게 추천 솔루션을 통한 마케팅을 제언하는걸 주제로 선정하였습니다. 

—------------------------  2. 탐색적 분석 —----------------------------
탐색적 분석에서는 크게 외부요인 분석과 내부요인 분석으로 조사하였습니다. 
먼저 외부요인 분석 결과 롯데마트에서 2015년 유통 키워드를 어렵다는 의미의 ‘HARD’로 선정하였는데 H는 유통업체의 대형 세일, A는 유통업체들의 배송전쟁, R은 온라인시장에 대응하는 오프라인 매장만의 강점을 어필하기 위한 공간의 재창조, D는 안전에 대한 열망을 의미합니다. 

이 네가지의 키워드를 유통키워드로 선정한 원인을 파악해본 결과 

H
경기 침체가 장기화되면서 소비 심리가 위축되어 구매 활성화를 위해 대형 할인 행사를 진행하며, 정부주도 행사에도 적극 동참하는 등 꺼져가는 소비 불씨를 살리기 위한 다양한 노력을 기울였습니다.  
대표적으로 정부주도 행사인 코리아 블랙프라이데이로 인해 전년 동기 대비 약 20% 가량 매출이 증가하였으며, 민간소비는 57개월 만에 최대폭으로 증가한 효과를 얻을 수 있었습니다. 

A
소셜커머스 회사에서 시작된 배송전쟁이 온오프라인 유통업계 전반으로 확산되었는데 
주문 후 차에서 내리지 않고 제품을 수령 할 수 있는 드라이브&픽 서비스, ‘3시간 배송이 가능한’ 인프라 구축, 오토바이 퀵 배송 서비스 등 마트와 백화점에서 차별화된 배송 서비스를 선보였습니다. 
 
이에 따라 대형마트, SSM 등 유통업체 온라인 전용 물류센터를 구축하여 ‘옴니채널 시스템 등 기존 온라인 배송과는 차별화되는 서비스를 제공하여 경쟁력을 강화하는 모습을 보였습니다. 

R
다음 r은 온라인 유통업체의 성장으로 오프라인 매장만의 강점을 어필하여 소비자를 끌어들일만한 오프라인 매장만의 매력이 필요한 시기를 뜻하며 

D
마지막 D는 “안전에 대한 열망”으로  6월 ‘메르스 확산으로 대규모 다중시설인 백화점 대형마트 등 전년 동월 대비 약 10% 매출이 감소하였고, 10월에는 세계보건기구에서 ‘가공육 발암 위험성’의 발표로 인해 대형마트를 비롯한 햄버거, 핫도그 등 가공육을  주 재료로하는 프렌차이즈 업계까지 큰 폭으로 매출이 감소하는 추세를 보였습니다. 

롯데그룹 계열사의 ‘롯데 멤버스’는 오프라인 기반의 롯데 맴버스의 회원과 온라인 기반의 롯데 패밀리 회원을 통합하여 ‘롯데 멤버스’를 L.POINT로 명칭을 바꿨습니다. 

저희는 이 L.POINT에서 제공하는 14년도와 15년도 총 2년간 구매 고객의 데이터를 기반으로 진행하였습니다. 

제공데이터는 크게 6가지로 고객정보, 경쟁사 이용 정보, 멤버십 여부, 상품분류, 채널 이용 정보, 구성되어 있습니다. 

—----------내부 데이터 탐색—-----------
저희는 이 내부 데이터를 탐색해보았는데요, 
먼저 고객 속성 정보를 확인 한 결과 2년간 구매한 전체 고객은 총 19383 (만 구천 삼백팔십삼)명이며, 80%는 여성으로 남성에 비해 3배 정도 많았으며, 연령 분포는 70%가 35세~54세 고객인걸 확인하였습니다. 
또한, 총 4개의 제휴사 (A, B, C, D) 와 경쟁사 데이터를 확인 해보니 전체 매출의 70%는 제휴사 A가 차지하였으며, 14년도 대비 15년도 총 매출이 감소한 제휴사는 B로 확인되었으며, 15년도 경쟁사 이용 횟수는 제휴사 b가 가장 많이 차지하고 있었습니다. 
이를 보았을 때, 제휴사별 어떤 상품이 있는지 확인이 필요했으며, 그 전에 전체 매출을 탐색해 보았습니다. 

전체매출은 크게 연도별, 분기별로 확인을 해보았는데요, 
연도별 매출을 확인 해 본 결과 14년 대비 15년도에 5.4% 증가하였으며, 
분기별로 구매 금액과 계절별로 구매 금액을 확인 했을 때, 분기별 매출은 전년 동기 대비 증가폭이 1분기가 가장 크고 4분기가 가장 적었으며, 계절별 매출은 전년 동기 대비 증가폭은 봄이 가장 크고, 여름이 가장 작은 추세를 보였습니다. 

두가지의 그래프를 보았을 때, 두 년도 모두 분기별, 계절별로 그래프가 
비슷한 추세를 보이고 있는걸 알 수 있는데요 더 자세히 확인하고자 월별 매출 현황을 확인해보았습니다. 

두 년도 모두 겨울에서 봄으로 갈 수록 증가하고, 봄에서 여름으로 갈 수록 감소, 여름에서 가을로 갈 수록 증가, 가을에서 겨울로 갈 수록 감소하는 추세를 보이고 있습니다. 
이에 저희는 매출이 계절성을 띄고 있어 데이터 활용시 전처리를 해주었습니다. 




—-------------------유지고객, 감소고객 정의 —-------------------
다음은 주세선정에서 가장 중요한 유지고객과 감소고객의 정의 인데요. 
먼저 유지고객을 확인 하기 위해 월 단위로 한번이라도 구매한 이력이 있는 고객을 확인한 결과 전체 고객의 91%를 차지하였고, 월 단위를 확대하여 분기별로 유지고객을 확인한 결과 전체 고객의 97%를 차지하여 
저희는 분석 단위 기간을 8분기로 나누고, 8분기 내내 구매 이력이 한번이라도 있는 사람을 분석 모델 단위 “유지 고객”으로 정의 하였습니다

.이 유지고객을 대상으로 감소고객을 정의하였는데 분기별로 단순 매출이 감소한 고객을 확인한 결과 총 감소 고객 수는 8579명으로 총 고객의 45% 정도가 감소했습니다. 1분기 대비 7분기 매출이 증가하였지만 단순 감소 고객수는 약 50%를 차지한걸 보고
저희는 단순 매출이 감소한걸 기준으로 두지않고 평균증감율을 활용하여 감소고객으로 정의하였습니다.

6분기 데이터로 다음 분기의 감소 여부를 확인하기 위해 (기준분기인 )1분기 구매 금액에 평균 증감율을 곱한 걸 기준금액으로 나타낸 후 이 기준금액이 (예측 분기인) 실제 7분기 구매 금액보다 적은 사람을 감소 고객으로 정의하였습니다. 

—-----------------------주제 선정—-------------------------
이렇게 정의한 유지고객과 감소고객을 갖고, 
6분기 데이터로 다음 분기의 감소고객을 예측하여 해당 감소고객의 구매패턴을 확인 후 매출 증가를 위한 추천 시스템을 활용하는걸 주제로 선정하였습니다. 

—------------------- 변수 설정—-----------------
다음은 변수 설정인데요 총 13개의 대분류 카테고리를 통합하기 위해 

<대대분류 카테고리>
1.	구매 고객 데이터에서 소분류별로 min, max, mean 매출액을 표시하고,
2.	분류로직 데이터를 활용하여 소분류별로 금액타입을 나타내주었습니다.
3.	이를 확인한 결과 분류로직 데이터에 있지만 구매고객 데이터에는 없는 ‘속옷’과 ‘웨딩’을 ‘의류’로 변경해 준 후 
4.	제휴사별, 대분류 카테고리, 금액타입별로 소분류 개수를 확인하고, 매출 평균값을 확인하고 크게 대분류 카테고리와 금액타입별로 매출액 min, max, mean값을 확인하여 공통적인 특징을 가진 대분류끼리 묶어주었습니다.
5.	그 결과, 침구와 주방, 의류와 의미용, 생활과 식품, 가구인테리어와 잡화, 교육문화와 아동, 가전과 레저취미&멀티샵을 묶어 총 6개의 대대분류 카테고리를 생성하였습니다.

<가중치 부여>
앞에서 보여줬듯이, 데이터가 계절성을 띄기 때문에 이 계절별 차이제거를 위해 
연도별, 분기별, 카테고리별, 금액타입별로 구매 금액 평균을 구한 후 가중치를 계산하여 원본 데이터에 적용하였습니다. 

위는 각 카테고리별로 총 4분기의 가중치를 구한 값이며 밑에 표는 해당 분기에 가중치를 곱해준 결괏값입니다. 저희는 이 가중치를 부여한 데이터를 활용해주었습니다.

—---------------모델 학습예측평가—---------------------
다음은 모델 학습 및 예측평가입니다.
우선 데이터를 학습용과 테스트용으로 분리를 해주었는데요. 
1분기에서 6분기 데이터를 학습 데이터의 독립변수로, 1분기 대비 7분기 증감여부를 학습 데이터의 종속변수로 지정하고,
2분기에서 7분기 데이터를  test 데이터의 독립변수, 2분기 대비 8분기 증감여부를 test 용 데이터의 종속변수로 지정해주었습니다.

다음은 모델 학습에 활용할 피처 설정을 해주었는데요,
고객정보에서 5세단위로 연령을 나눠주고, 식품 카테고리 구매액을 활용하여 소득을 추정하기 위한 지수인 ENGEL지수를 구해주었습니다. 
또한, 학습용과 TEST 데이터의 분기 기간을 기준으로 주말에 구매한 비율과, 각각의 분기 기간 동안의 대대분류 카테고리별로 구매 금액과 구매 횟수의 추세선 기울기를 나타내 변수로 설정해 주었습니다.

또한, 고객별로 분기와 카테고리별로 구매 금액에 대한 등급을 정의 해 준 후 2(두)분기간의 등급의 차이를 2가지의 방법으로 계산하여 하나의 지수로 설정해 주었습니다. 
첫번째는 단순 차이를 더해 변동폭으로 나타내주었고, 두번째는 2분기간의 차이에 절댓값을 씌워 절대 변동폭으로 나타내주었습니다. 

이렇게 설정한 총 7가지의 변수를 가지고 감소고객 예측 모델을 생성해 주었는데요, 
처음엔 최적의 모델을 구하기 위해 훈련용 데이터를 8:2 비율로 train과 test용으로 분리 후 파이캐럿의 모듈을 이용하여 정확도를 구해 본 결과 LightGBM이 가장 높은 정확도로 나와 
이 lgb 모듈을 갖고 Grid search CV로 최적의 파라미터를 구한 후,
다시 처음에 설정한 훈련용데이터와 test 데이터로 모델을 학습 해 주었습니다. 
그 결과 예측 정확도는 약 73%, auc 스코어는 약 79%로 평가 되어 이 모델을 
최종 감소고객을 예측하는 모델로 선정해 주었습니다.

학습한 모델로 군집화를 진행하기 전 피처중요도를 확인 해 주었습니다.
이를 정리하여 보여주면 구매횟수과 구매금액의 추세선과, 등급을 부여한 변동폭과 절대 변동폭에서 높은 중요도를 보여주는 카테고리를 확인하였습니다. 
이는 군집화에서 활용할 예정입니다. 

최종적으로 저희는 학습한 모델로 3분기~8분기 데이터를 가지고 3분기 대비 9분기 증감여부를 예측 후 예측감소고객을 뽑아주었습니다.


—------------------------군집화—-----------------------
이 감소고객을 대상으로 마케팅 제언을 위해 먼저 군집화를 통해 군집별 구매 특징을 파악해 보았습니다.
유지고객 중 감소 예측으로 분류된 고객은 8150명으로 이를 대상으로 총 5개의 군집으로 나타냈습니다. 군집개수를 5개로 설정한 이유는 k-means 를 활용하여 실루엣 계수가 가장 높게 나온 5개의 군집으로 나눠주었습니다.

군집별 특징을 확인한 결과 
1번째 클러스터는 의류/이미용_중가에서 구매횟수 추세선 및 구매금액의 추세선이 다른 카테고리에 비해 매우 높게 나왔습니다. 하지만 총 변동폭은 마이너스위주이고 가장 낮았습니다.
추세선 지수가 가장 높게 나왔다는 뜻은 기준 분기 대비 마지막 분기 구매액이나 구매횟수가 큰폭으로 증가했다는 의미인데 단순히 증가폭이 크다고해서 해당 분기내에서 구매가 증가했다는 뜻으로 보긴 어려워 이를 확인하기 위해 분기별로 3가지 방법으로 값을 확인해보았습니다.
 1) 고객별 평균 구매금액과 2) 군집전체의 평균 구매금액, 3) 총 구매 횟수로 나타내어 확인한 결과 급격한 감소나 증가가 보이지 않고 전체적으로 보았을때 증가세를 이어가고 있었습니다. (다음페이지)
따라서, 저희는 이 군집을 의류/이미용_중가에 대한 관여도가 높다고 해석해 개인의 과거 구매 패턴을 고려하여 의류/이미용_중가 상품 중 새로운 것을 주기적으로 추천하는 마케팅을 설정하였습니다.

다음 두번째 군집은 평균 주말 구매 비율이 53%로 군집중 가장 높게 나타났으며, 식품/생활_중가 구매액 및 구매횟수 추세선이 가장 낮게 나타났습니다. 
추세선이 가장 낮게 나타났다는 뜻은 기준분기 대비 타겟분기에 증가폭이 크지 않다는 뜻이기 때문에 안의 분기 내에서 변동을 보기 위해 앞에서 구한 것과 같이 분기별 구매 금액과 구매 횟수를 확인해보았습니다. 
그 결과, 구매금액에서는 고객별 평균구매금액에서는 큰 감소나 증가폭이 보이지 않았으나 평균구매금액은 분기별로 증감폭이 크게 차이가 났고, 총 구매 횟수는 점차 증가하다 마지막분기에는 감소하는 추세를 보였습니다.
또 다른 카테고리인 의류/이미용_중가도 마찬가지로 감소나 증가로 이어지는 분기 기간만 다를 뿐 전체 고객 평균 차이는 큰 폭을 보이는걸 확인하였습니다. (다음페이지)
두 카테고리모두 구매횟수는 증가하나 구매액이 감소하는 경향이 있었고,
식품/생활_중가의 경우 8분기에 구매액, 구매횟수 모두 감소하여 이를 해결하기 위해 기존에 구매한 이력이있는 아이템 중 구매횟수가 잦았던 아이템을 기반으로 추천 적용하고, 의류/이미용_중가는 구매액과 구매횟수 모두 증가 추세이므로 이를 유지해 매출 증대로 이어지게하기 위해 구매 이력이 없는 아이템 중 추천 시스템을 적용하기로 하였습니다.

다음 3번 군집은 식품/생활의 모든 금액타입에서 특징을 발견했습니다.
먼저 고가인 경우 구매 횟수 및 구매액 추세선이 높게 나타났지만, 구매금액 등급 변동폭이 마이너스고, 절대등급폭 평균이 군집내 두번째로 높게 나타났습니다. 이는 해당 카테고리의 구매변동이 있었음을 의미하며,

중가와 저가의 경우 구매금액의 추세선은 높지만 절대변동폭이 타 군집에 비해 가장 높게 나타났습니다. 이는 중간 분기 간 변동이 크게 있었음을 의미하며 해당 분기의 평균 구매금액 그래프를 보면 분기 내 변동이 있었지만 고객별 평균 구매금액을 살펴보면 지속적으로 증가하는 추세를 보이고 있었습니다. (다음 페이지)
이를 기반으로 해당 군집이 일명 ‘식품 레저화’ 고객으로 다양한 식품을 소비하고 있음을 확인하습니다. 따라서, 군집3번 고객을 대상으로는 식품 고가, 중가, 저가를 이미 소비했던 제품 및 사보지 않은 제품들을 다양하게 추천하는걸 마케팅으로 설정하였습니다.

다음 4번 군집은 엥겔지수가 가장 높게 나타났습니다. 그러나 식품/생활쪽에서 뚜렷한 차이를 보이지 않은 군집이였는데 
해당 군집은 가전/레저취미/멀티샵_중가에서 구매금액 추세선과 구매횟수 추세선이 마이너스로 낮게 나타났으며, 타군집 대비 변동폭과 절대변동폭은 가장 높게 나타났습니다.

가구인테리어/잡화_고가의 경우 평균구매금액과 구매 횟수가 증가 및 감소를 이어오다 최근 가구인테리어에 관심도가 높아진것으로 보여졌습니다. 
이를 기반으로, (다음 페이지)
가전/레저취미 아이템들은 대부분 제품생애주가기 길고 한번 구매하면 오래 사용하는 특징을 가지는데 해당 군집은 현재 구매금액 감소가 지속된지 오래되었고, 구매 횟수 역시 감소하는 추세이므로 추천시스템으로 구매한 제품에 필요한 관련 부속품들을 추천하는 시스템을 적용하고 가구인테리어 카테고리는 최근 관심도가 높아진 것을 토대로
계속해서 흥미를 느끼도록 소비이력이 없는 새로운 가구인테리어/잡화 제품을 추천하도록 하였습니다.

마지막 군집인 5번은 식품 생확 고가 절대변동폭이 가장 크게 나타난 군집이고, 
평균 구매금액이 증가-> 감소, 감소->증가되는 폭이 크게 나타나며, 8분기인 현재 매우 감소세를 타고 있으므로, (다음페이지)
기존에 소비했던 제품 중 식품/생활 고가제품을 추천하기로 함

마지막으로 서프라이즈를 활용한 추천시스템입니다.

먼저 상품별 구매 건수와 단가를 활용한 상품별 단가 가중치를 구한 후 고객별 구매 건수 합으로 나눠 고객별 상품별 구매지수를 상품에대한 관여도로 나타내주었습니다.

이 구매 지수를 활용하여 surprise api를 활용한 잠재요인 협업 필터링 기반의 개인화된 추천 시스템 모델을 학습 후, 해당 학습 모델로 해당 고객의 구매 상품과 미구매 상품의 구매 지수를 예측하는 순서로 구해주었습니다.

이 예측 구매 지수를 기반으로
고객별 구매 상품과 미구매 상품의 구매지수를 내림차순으로 정렬 후 TOP100개의 추천 상품을 추출하여 고객을 위한 카테고리별 상품을 추천하는 형태로 출력해 주었습니다. 
이때, 카테고리별로 분류한 후, 해당 고객 속성 정보 및 상품별 상세 정보와 함께 추천 결과를 나타내주었습니다.
오른쪽은 추천 시스템 결과 예시인데, 해당 군집과 고객 번호를 입력시, 
이렇게 고객의 속성정보가 나오고, 
각 카테고리별로 구매 지수가 높은 순서로 제휴사와 대분류, 중분류명과 추천상품 및 금액타입을 같이 제공하는 형태로 나타내주었습니다. 

다음은 군집별 SVD 모델 학습 평가 결과 입니다. 
군집 1은 RMSE가 0.005, 군집 2는 0.006, 군집 3은 0.006, 군집 4는 0.004, 군집 5는 0.008로 나타났습니다. 
이를 

